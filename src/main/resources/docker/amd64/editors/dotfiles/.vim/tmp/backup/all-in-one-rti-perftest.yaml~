#apiVersion: v1
#kind: Service
#metadata:
#  name: "rti-perftest-k8s"
#  namespace: itvl-buc-adrien
#  labels:
#      app: rti-perf-nwk-svc
#spec:
#  podSelector:
#    matchLabels:
#      app: rti-perftest
#      id: "k8s"
#  policyTypes:
#    - Ingress
#    - Egress
#  ingress:
#    - from:
#        - podSelector:
#            matchLabels:
#                app: rti-perftest
#                 id: "k8s"
#  egress:
#  - to:
#    - podSelector:
#        matchLabels:
#          app: rti-perftest
#          id: "k8s"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: rti-perftest-k8s-pub
  labels:
    app: rti-perftest
    role: pub
    id: "k8s"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: rti-perftest
      role: pub
      id: "k8s"
  template:
    metadata:
      labels:
        app: rti-perftest
        role: pub
        id: "k8s"
    spec:
      containers:
        - name: rti-perftest-k8s-pub
          image: registry.gear.ge.com/100034251/rti-perftest:latest
          args:
            - "/home/happyman/cloud-rtiperftest/perftest_cpp"
            - "-domain"
            - "0"
            - "-pub"
            - "-enableTurboMode"
            - "-dataLen"
            - "1024"
            - "-sleep"
            - "1"
            - "-verbosity"
            - "2"
          ports:
            - containerPort: 7600
              protocol: "UDP"
              name: "rtps2-disc-mult"
            - containerPort: 7601
              protocol: "UDP"
              name: "rtps2-disc-uni"
            - containerPort: 7610
              protocol: "UDP"
              name: "rtps2-data-mult"
            - containerPort: 7611
              protocol: "UDP"
              name: "rtps2-data-uni"
---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: rti-perftest-k8s-sub-2019
  labels:
    app: rti-perftest
    role: sub
    id: "k8s"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: rti-perftest
      role: sub
      id: "k8s"
  template:
    metadata:
      labels:
        app: rti-perftest
        role: sub
        id: "k8s"
    spec:
      containers:
        - name: rti-perftest-k8s-sub
          image: registry.gear.ge.com/100034251/rti-perftest:latest
          args:
            - "perftest_cpp"
            - "-domain"
            - "0"
            - "-sub"
            - "-verbosity"
            - "2"
            - "-sidMultiSubTest"
            - "2019"
          env:
            - name: POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
          ports:
            - containerPort: 7600
              protocol: "UDP"
              name: "rtps2-disc-mult"
            - containerPort: 7601
              protocol: "UDP"
              name: "rtps2-disc-uni"
            - containerPort: 7610
              protocol: "UDP"
              name: "rtps2-data-mult"
            - containerPort: 7611
              protocol: "UDP"
              name: "rtps2-data-uni"

